<section class="py-5">
  <div class="container" style="max-width: 960px;">
    <div class="mb-4 text-center">
      <h2 class="fw-semibold mb-2">Upload a photo</h2>
      <p class="text-muted-leaf mb-0">PNG, JPG, or JPEG. Max size 10 MB.</p>
    </div>

    <div
      class="dropzone card-leaf p-4 p-md-5 text-center"
      [class.dragover]="isDragOver"
      (dragover)="handleDragOver($event)"
      (dragleave)="handleDragLeave($event)"
      (drop)="handleDrop($event)"
    >
      <div class="d-flex flex-column align-items-center justify-content-center gap-3">
        <div class="rounded-circle d-flex align-items-center justify-content-center" style="width:64px;height:64px;background: rgba(182,206,180,.18);">
          <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 16V4m0 0 4 4m-4-4-4 4" stroke="#3e8960" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M20 16.5A3.5 3.5 0 0 1 16.5 20h-9A3.5 3.5 0 0 1 4 16.5c0-1.65 1.12-3.04 2.63-3.41A5 5 0 0 1 16 9a4.01 4.01 0 0 1 3.72 2.62A3.5 3.5 0 0 1 20 16.5Z" stroke="#6b8f6a" stroke-width="1.4" stroke-linecap="round"/>
          </svg>
        </div>
        <div>
          <p class="mb-1">Drag and drop your image here</p>
          <p class="text-muted mb-3">or</p>
          <label class="btn btn-leaf px-4">
            Browse files
            <input
              type="file"
              class="visually-hidden"
              (change)="onFileSelected($event)"
              accept=".png,.jpg,.jpeg,image/png,image/jpeg"
            >
          </label>
        </div>
        <div *ngIf="selectedFile" class="mt-2">
          <span class="badge text-bg-light border" style="border-color: var(--leaf-border);">{{ selectedFile.name }} ({{ selectedFile.size / 1024 | number:'1.0-0' }} KB)</span>
          <button type="button" class="btn btn-sm btn-outline-secondary ms-2" (click)="clearFile()">Remove</button>
        </div>
        <div *ngIf="errorMessage" class="alert alert-danger mt-3 mb-0 py-2 px-3" role="alert">{{ errorMessage }}</div>
      </div>
    </div>

    <div class="mt-4">
      <div class="card-leaf p-3 p-md-4">
        <label for="promptInput" class="form-label fw-semibold mb-2">Enter anything</label>
        <div class="input-group">
          <textarea id="promptInput" class="form-control prompt-textarea" rows="2" placeholder="Describe symptoms, plant type, context..." [(ngModel)]="prompt" maxlength="600"></textarea>
        </div>
      </div>
    </div>

    <div class="text-center mt-4">
      <button class="btn btn-leaf btn-lg px-4" [disabled]="!selectedFile || !!errorMessage || isLoading" (click)="submit()">
        <span *ngIf="!isLoading">Analyze</span>
        <span *ngIf="isLoading" class="d-inline-flex align-items-center gap-2">
          <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
          Analyzing...
        </span>
      </button>
    </div>

    <div *ngIf="result" class="mt-4">
      <div class="card-leaf p-3 p-md-4">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <h5 class="mb-0">Result</h5>
          <ng-container *ngIf="result?.data?.filename as fname">
            <span class="badge text-bg-light border" style="border-color: var(--leaf-border);">{{ fname }}</span>
          </ng-container>
          <span *ngIf="!result?.data?.filename && resultModel" class="badge text-bg-light border" style="border-color: var(--leaf-border);">{{ resultModel }}</span>
        </div>
        <div *ngIf="resultText; else rawJson" class="mb-0" style="white-space: pre-wrap; word-break: break-word;">{{ resultText }}</div>
        <ng-template #rawJson>
          <pre class="mb-0" style="white-space: pre-wrap; word-break: break-word;">{{ result | json }}</pre>
        </ng-template>
      </div>
    </div>
  </div>
</section>
